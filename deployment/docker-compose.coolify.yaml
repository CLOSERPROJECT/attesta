services:
  mongodb:
    image: mongo:7.0

  cerbos:
    build:
      context: .
      dockerfile: deployment/Dockerfile.cerbos
    restart: unless-stopped
    command: ["server", "--config=/config/config.yaml"]

  attesta:
    build:
      context: .
      dockerfile: deployment/Dockerfile.coolify
    environment:
      MONGODB_URI: mongodb://${SERVICE_NAME_MONGODB}:27017
      CERBOS_URL: http://${SERVICE_NAME_CERBOS}:3592
      APPWRITE_ENDPOINT: ${APPWRITE_ENDPOINT:-}
      APPWRITE_PROJECT_ID: ${APPWRITE_PROJECT_ID:-}
      APPWRITE_API_KEY: ${APPWRITE_API_KEY:-}
      APPWRITE_TEAMS_STRICT: ${APPWRITE_TEAMS_STRICT:-false}
      APPWRITE_SYNC_FROM_WORKFLOW: ${APPWRITE_SYNC_FROM_WORKFLOW:-false}
      APPWRITE_SYNC_STRICT: ${APPWRITE_SYNC_STRICT:-false}
      APPWRITE_SYNC_DEFAULT_PASSWORD: ${APPWRITE_SYNC_DEFAULT_PASSWORD:-TempPassw0rd!}
      APPWRITE_SYNC_MEMBERSHIP_URL: ${APPWRITE_SYNC_MEMBERSHIP_URL:-http://localhost:3030}
      SERVICE_FQDN_ATTESTA_3000:
    depends_on:
      - mongodb
      - cerbos

  mongoexpress:
    image: mongo-express:1.0.2
    environment:
      ME_CONFIG_MONGODB_URL: mongodb://${SERVICE_NAME_MONGODB}:27017
      SERVICE_FQDN_MONGOEXPRESS_8081:
    depends_on:
      - mongodb
