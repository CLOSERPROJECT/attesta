{{define "org_admin_body"}}
<section class="panel landing">
  <h1>Org Admin</h1>
  <p class="muted">Organization: <strong>{{.Organization.Name}}</strong> (<code>{{.Organization.Slug}}</code>)</p>
  {{if .Error}}<p class="muted" style="color: #a91919;">{{.Error}}</p>{{end}}
  {{if .InviteLink}}
    <p class="muted">Invite link: <a href="{{.InviteLink}}">{{.InviteLink}}</a></p>
  {{end}}
</section>

<section class="panel">
  <h2>Create Role</h2>
  <form method="post" action="/org-admin/roles" class="input-form">
    <label for="role-name">Role name</label>
    <input id="role-name" name="name" type="text" required />
    <label for="role-color">Role color</label>
    <input id="role-color" name="color" type="color" value="#000000" />
    <label for="role-border">Role border color</label>
    <input id="role-border" name="border" type="color" value="#000000" />
    <button class="primary" type="submit">Create role</button>
  </form>
</section>

<section class="panel">
  <h2>Invite User</h2>
  <form method="post" action="/org-admin/users" class="input-form">
    <input type="hidden" name="intent" value="invite" />
    <label for="user-email">Email</label>
    <input id="user-email" name="email" type="email" required />
    <fieldset class="checkbox-group">
      <legend>Roles</legend>

      {{range .Roles}}
        <label class="checkbox-item">
          <input type="checkbox" name="roles" value="{{.Slug}}" />
          <span>{{.Name}} ({{.Slug}})</span>
        </label>
      {{end}}

      <p class="muted">Select one or more roles (optional).</p>
    </fieldset>
    <button class="primary" type="submit">Create invite</button>
  </form>
</section>

<section class="panel">
  <h2>Invites I sent</h2>
  {{if .Invites}}
    <table class="status-table">
      <thead>
        <tr>
          <th>Email</th>
          <th>Roles</th>
          <th>Status</th>
          <th>Created</th>
          <th>Expires</th>
        </tr>
      </thead>
      <tbody>
        {{range .Invites}}
          <tr>
            <td>{{.Email}}</td>
            <td>
              {{if .RoleSlugs}}
                {{range .RoleSlugs}}<code>{{.}}</code> {{end}}
              {{else}}
                <span class="muted">none</span>
              {{end}}
            </td>
            <td>{{.Status}}</td>
            <td>{{.CreatedAt}}</td>
            <td>{{.ExpiresAt}}</td>
          </tr>
        {{end}}
      </tbody>
    </table>
  {{else}}
    <p class="muted">No invites sent yet.</p>
  {{end}}
</section>

<section class="panel">
  <h2>Users</h2>
  {{if .Users}}
    <table class="status-table">
      <thead>
        <tr>
          <th>Email</th>
          <th>Status</th>
          <th>Roles</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {{range .Users}}
          <tr>
            <td>{{.Email}}</td>
            <td>{{if .Activated}}Active{{else}}Invited{{end}}</td>
            <td>
              <span>
                {{range .RoleOptions}}
                  {{if .Selected}}
                    <span class="dept-badge" style="--dept-color: {{.RoleColor}}; --dept-border: {{.RoleBorder}}">
                      {{.Name}}
                    </span>
                  {{end}}
                {{end}}
              </span>
            </td>
            <td>
              <button type="button" class="secondary" onclick="document.getElementById('manage-user-{{.UserID}}').showModal()">
                Manage
              </button>
              <dialog id="manage-user-{{.UserID}}">
                <form method="post" action="/org-admin/users" class="input-form">
                  <input type="hidden" name="intent" value="set_roles" />
                  <input type="hidden" name="userId" value="{{.UserID}}" />
                  <fieldset class="checkbox-group">
                    <legend>Edit roles for {{.Email}}</legend>
                    {{range .RoleOptions}}
                      <label class="checkbox-item">
                        <input type="checkbox" name="roles" value="{{.Slug}}" {{if .Selected}}checked{{end}} />
                        <span>{{.Name}} ({{.Slug}})</span>
                      </label>
                    {{end}}
                  </fieldset>
                  <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="submit">Save roles</button>
                    <button type="button" class="secondary" onclick="document.getElementById('manage-user-{{.UserID}}').close()">Cancel</button>
                  </div>
                </form>
                <form method="post" action="/org-admin/users" class="input-form" style="margin-top: 10px;">
                  <input type="hidden" name="intent" value="delete_user" />
                  <input type="hidden" name="userId" value="{{.UserID}}" />
                  <button type="submit">Delete account</button>
                </form>
              </dialog>
            </td>
          </tr>
        {{end}}
      </tbody>
    </table>
  {{else}}
    <p class="muted">No users found in this organization.</p>
  {{end}}
</section>
{{end}}

{{define "org_admin.html"}}
  {{template "layout.html" .}}
{{end}}
