{{define "home_picker_body"}}
<section class="panel landing landing-wide">
  <h1>Choose a stream</h1>
  <p class="muted">Select a stream to start or continue process tracking.</p>
  {{if .Workflows}}
    <div class="workflow-grid">
      {{range .Workflows}}
        <a class="workflow-card" href="/w/{{.Key}}/">
          <h2 class="workflow-card-title">{{.Name}}</h2>
          {{if .Description}}
            <p class="workflow-card-description">{{.Description}}</p>
          {{end}}
          <dl class="workflow-card-stats">
            <div>
              <dt>Not started</dt>
              <dd>{{.Counts.NotStarted}}</dd>
            </div>
            <div>
              <dt>Started</dt>
              <dd>{{.Counts.Started}}</dd>
            </div>
            <div>
              <dt>Terminated</dt>
              <dd>{{.Counts.Terminated}}</dd>
            </div>
          </dl>
        </a>
      {{end}}
    </div>
  {{else}}
    <p class="muted">No streams configured.</p>
  {{end}}
</section>
{{end}}

{{define "home_body"}}
<div class="stack">
  <section class="hero">
    <button class="secondary" onclick="location.href='/'">
      <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon-svg icon-svg-md" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
      </svg>
      Back
    </button>
    <h1 class="hero-title">{{.WorkflowName}}</h1>
    <form method="post" action="{{.WorkflowPath}}/process/start">
      <button class="primary" type="submit">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="icon-svg icon-svg-md" viewBox="0 0 16 16">
          <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>
        </svg>
        New stream
      </button>
    </form>
  </section>

  <section class="panel">
    <div class="process-toolbar">
      <h2 style="margin: 0;">All streams</h2>
      <form method="get" action="{{.WorkflowPath}}/" class="process-sort">
        <label class="muted" for="sort" style="font-size: 13px;">Sort</label>
        <select id="sort" name="sort" onchange="this.form.submit()">
          <option value="time_desc" {{if eq .Sort "time_desc"}}selected{{end}}>Newest</option>
          <option value="time_asc" {{if eq .Sort "time_asc"}}selected{{end}}>Oldest</option>
          <option value="progress_desc" {{if eq .Sort "progress_desc"}}selected{{end}}>Most advanced</option>
          <option value="progress_asc" {{if eq .Sort "progress_asc"}}selected{{end}}>Least advanced</option>
          <option value="status" {{if eq .Sort "status"}}selected{{end}}>Status</option>
        </select>
      </form>
    </div>

    {{if .Processes}}
      <ul class="process-list">
        {{range .Processes}}
          <li class="process-item">
            <div class="process-head">
              <a href="{{$.WorkflowPath}}/process/{{.ID}}">{{.ID}}</a>
              <span class="status-tag status-{{.Status}}">{{.Status}}</span>
            </div>
            <div class="process-progress-line" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{.Percent}}">
              <div class="process-progress-fill" style="width: {{.Percent}}%;"></div>
            </div>
            <div class="substep-meta" style="margin-top: 10px;">
              <span>{{.DoneSubsteps}} / {{.TotalSubsteps}} ({{.Percent}}%)</span>
              <span>Created: {{.CreatedAt}}</span>
              {{if .LastNotarizedAt}}
                <span>Last notarized: {{.LastNotarizedAt}}</span>
              {{end}}
              {{if .LastDigestShort}}
                <span class="pill">sha256 {{.LastDigestShort}}</span>
              {{end}}
            </div>
          </li>
        {{end}}
      </ul>
    {{else}}
      <p class="muted" style="margin: 12px 0 0;">No streams yet.</p>
    {{end}}
  </section>

  <section class="panel">
    <h2 style="margin-top: 0;">History</h2>
    {{if .History}}
      <ul class="process-list">
        {{range .History}}
          <li class="process-item">
            <div class="process-head">
              <a href="{{$.WorkflowPath}}/process/{{.ID}}">{{.ID}}</a>
              <span class="status-tag status-{{.Status}}">{{.Status}}</span>
            </div>
            <div class="process-progress-line" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{.Percent}}">
              <div class="process-progress-fill" style="width: {{.Percent}}%;"></div>
            </div>
            <div class="substep-meta" style="margin-top: 10px;">
              <span>{{.DoneSubsteps}} / {{.TotalSubsteps}} ({{.Percent}}%)</span>
              <span>Created: {{.CreatedAt}}</span>
              {{if .LastNotarizedAt}}
                <span>Last notarized: {{.LastNotarizedAt}}</span>
              {{end}}
              {{if .LastDigestShort}}
                <span class="pill">sha256 {{.LastDigestShort}}</span>
              {{end}}
            </div>
          </li>
        {{end}}
      </ul>
    {{else}}
      <p class="muted" style="margin: 12px 0 0;">No finished streams yet.</p>
    {{end}}
  </section>
</div>
{{end}}

{{define "home.html"}}
  {{template "layout.html" .}}
{{end}}
