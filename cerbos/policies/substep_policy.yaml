apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: "default"
  resource: "substep"
  rules:
    - actions: ["complete"]
      effect: EFFECT_ALLOW
      roles: ["dep1", "dep2", "dep3"]
      condition:
        match:
          all:
            of:
              - expr: request.resource.attr.sequenceOk == true
              - expr: request.resource.attr.roleRequired in request.principal.roles
              - expr: request.resource.attr.workflowKey == request.principal.attr.workflowKey
              - expr: request.principal.attr.appwriteTeamsEnabled == false || size(request.resource.attr.requiredTeamIds) == 0 || request.resource.attr.requiredTeamIds.exists(teamId, teamId in request.principal.attr.appwriteTeamIds)
