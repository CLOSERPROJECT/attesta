apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: "default"
  resource: "substep"
  rules:
    - actions: ["complete"]
      effect: EFFECT_ALLOW
      roles: ["authenticated"]
      condition:
        match:
          all:
            of:
              - expr: request.resource.attr.sequenceOk == true
              - expr: request.principal.attr.workflowKey == request.resource.attr.workflowKey
              - expr: request.principal.attr.orgSlug == request.resource.attr.orgSlug
              - expr: request.principal.attr.activeRole in request.principal.attr.roleSlugs
              - expr: request.principal.attr.activeRole in request.resource.attr.rolesAllowed
